Comment: |
  This is a template recipe and cannot be used without a RecipeOverride.
  UNTESTED_RECIPE_IDENTIFIER must be supplied
Description: Creates a Jamf Update Policy for a given title
Identifier: com.github.smithjw-actions.jamf.auto_update_ea.App
MinimumVersion: '2.9'

Input:
  NAME: ''
  SOFTWARE_TITLE: ''
  APPLICATION_TITLE: null
  BYPASS_STOP_PROCESSING_IF_PKG_UPLOADED: 'False'
  EXTENSION_ATTRIBUTE_NAME: null
  EXTENSION_ATTRIBUTE_SCRIPT: null
  PARENT_RECIPE_IDENTIFIER: null
  POLICY_CATEGORY: Apps - Auto-Update
  POLICY_CUSTOM_TRIGGER: install-%SOFTWARE_TITLE%
  POLICY_FREQUENCY: Once every day
  POLICY_NAME: null
  POLICY_TEMPLATE: Policy_Template-Auto-Update.xml
  SMART_GROUP_NAME: null
  SMART_GROUP_TEMPLATE: Smart_Group-Auto-Update-App-Bundle.xml

Process:
  - Processor: com.github.grahampugh.recipes.preprocessors/LastRecipeRunChecker
    Arguments:
      cache_dir: '%CACHE_DIR%'
      recipeoverride_identifier: '%PARENT_RECIPE_IDENTIFIER%'

  # This processor is used to allow the recipe to run and create the policy even if the result
  # of LastRecipeRunChecker shows that the upload.jamf recipe did not upload a new version.
  - Processor: StopProcessingIf
    Arguments:
      predicate: 'pkg_uploaded == %BYPASS_STOP_PROCESSING_IF_PKG_UPLOADED%'

  - Processor: com.github.grahampugh.recipes.commonprocessors/VersionRegexGenerator

  - Processor: com.github.grahampugh.jamf-upload.processors/JamfExtensionAttributeUploader
    Arguments:
      ea_name: '%EXTENSION_ATTRIBUTE_NAME%'
      ea_script_path: '%EXTENSION_ATTRIBUTE_SCRIPT%'
      replace_ea: 'True'
      sleep: 1

  - Processor: com.github.grahampugh.jamf-upload.processors/JamfComputerGroupUploader
    Arguments:
      computergroup_name: '%SMART_GROUP_NAME%'
      computergroup_template: '%SMART_GROUP_TEMPLATE%'
      replace_group: 'True'

  - Processor: com.github.grahampugh.jamf-upload.processors/JamfPolicyUploader
    Arguments:
      icon: ''
      policy_name: '%POLICY_NAME%'
      policy_template: '%POLICY_TEMPLATE%'
      replace_policy: 'True'
